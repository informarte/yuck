name: ci

on: [push]

env:
  ACTIONS_RUNNER_DEBUG: true
  ACTIONS_STEP_DEBUG: true

jobs:
  ci:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - run: pwd
      - run: wget https://github.com/MiniZinc/MiniZincIDE/releases/download/2.7.6/MiniZincIDE-2.7.6-bundle-linux-x86_64.tgz
      - run: tar xzf MiniZincIDE-2.7.6-bundle-linux-x86_64.tgz
      - run: ldd ./MiniZincIDE-2.7.6-bundle-linux-x86_64/bin/minizinc
      - run: ldd ./MiniZincIDE-2.7.6-bundle-linux-x86_64/bin/fzn-gecode
      - run: ./MiniZincIDE-2.7.6-bundle-linux-x86_64/bin/minizinc --version
      - run: echo "$PWD/MiniZincIDE-2.7.6-bundle-linux-x86_64/bin" >> $GITHUB_PATH
      - run: echo $PATH
      - run: minizinc --version
      - run: fzn-gecode -help
      - run: pwd
      - run: make ci-tests
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: artifacts
          path: tmp/
